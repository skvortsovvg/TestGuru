<h1 style="margin-bottom: 10px;"><%= t(".title") %> "<%= @result.test.title %>"</h1>

<div class="progress mb-2">
  <div class="progress-bar" role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
</div>

<%= form_with url: result_path(@result), method: :put do |form| %>
<%= render "shared/errors", object: @result %>

<div class="card" data-current-qst-number="<%= @result.answered_questions %>" data-qst-count="<%= @result.test.questions.count %>">
  <div class="card-header">
    <%= "#{ Question.model_name.human} № #{@result.answered_questions + 1}. #{@result.current_question.body}"  %>
  </div>
  <div class="card-body">
    <%= form.collection_radio_buttons :answer_id, @result.current_question.answers, :id, :body, include_hidden: false do |b| %>
      <p>
        <%= b.radio_button class: "form-check-input align-middle" %>
        <%= b.label class: "form-check-label ms-2 align-middle" %>
      </p>
    <% end %>
    <%= link_to t('.to_tests'), tests_path, class: "btn btn-primary" %>
    <%= form.submit t('.next'), class: "btn btn-success" %>    
  </div>
  <div class="card-footer text-muted">
    <%= "#{@result.answered_questions + 1} из #{@result.test.questions.count}" %> | 
    <% if @gist %> 
      <%= link_to "Gist: #{@gist.gist_id}", "https://gist.github.com/" + @gist.gist_id %>
    <% else %>
      <%= link_to t('.create_new_gist'), new_gist_result_path(@result), method: :post %>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  const pb = document.querySelector('.progress-bar');
  const current_qst_num = Number(document.querySelector('.card').dataset.currentQstNumber).toFixed(2);
  const qst_count = Number(document.querySelector('.card').dataset.qstCount).toFixed(2);
  const progress_value = current_qst_num/qst_count*100;

  if (current_qst_num > 1) {
    pb.style.width = pb.innerText = `${(current_qst_num-1)/qst_count*100}%`; //to show progress fill from prev to current value (not always from 0)
  }

  const change_pb = (pb, progress_value) => {  
      pb.style.width = pb.innerText = `${progress_value}%`;
      pb.ariaValueNow = progress_value;
    }
  
  window.addEventListener("load", () => change_pb(pb, progress_value))
</script>

<% end %>
